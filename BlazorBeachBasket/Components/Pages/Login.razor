@page "/login"
@rendermode InteractiveServer
@inject NavigationManager nav;
@using Db

<PageTitle>Login</PageTitle>

<div class="login-container">
    <form id="loginForm">

        <h1>Login</h1>


        <div class="input-group">
            <label for="username"><strong>Username:</strong></label><br>
            <input type="text" @bind-value=@Username id="username" required>
        </div>

        <div class="input-group">
            <label for="password"><strong>Password:</strong></label><br>
            <input type="password" @bind-value=@Password id="password" required>
        </div>

        <button @onclick="@LoginAuth" type="button">Login</button>

        <p></p>
    </form>
</div>


@code {
    private string Username { get; set; }
    private string Password { get; set; }

    Database database = new Database();
    protected override void OnInitialized()
    {
        database.ImportData();
        database.AssingData();
    }

    void LoginAuth()
    {
        foreach(User user in database.Users)
        {
            if(user.Username == Username && user.UserPassword == Password)
            {
                if (user.UserType == 0)
                {
                    Restaurant restaurant = database.Restaurants.FirstOrDefault(o => o.Restaurant_UserId == user.UserId);
                    string newUrl = $"/home/{restaurant.RestaurantId.ToString()}";
                    nav.NavigateTo(newUrl);
                }
                else if(user.UserType == 1)
                {
                    //Customer
                    Customer customer = database.Customers.FirstOrDefault(o => o.Customer_UserId == user.UserId);
                }
                else if(user.UserType == 2)
                {
                    //Driver
                }
            }
        }
    }
}
